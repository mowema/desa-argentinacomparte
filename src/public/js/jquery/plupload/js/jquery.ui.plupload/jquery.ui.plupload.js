(function(a,b,c,d,e){function h(a){a.html('<div class="plupload_wrapper">'+'<div class="ui-widget-content plupload_container">'+'<div class="plupload">'+'<div class="ui-state-default ui-widget-header plupload_header">'+'<div class="plupload_header_content">'+'<div class="plupload_header_title">'+g("Select files")+"</div>"+'<div class="plupload_header_text">'+g("Add files to the upload queue and click the start button.")+"</div>"+"</div>"+"</div>"+'<div class="plupload_content">'+'<table class="plupload_filelist">'+'<tr class="ui-widget-header plupload_filelist_header">'+'<td class="plupload_cell plupload_file_name">'+g("Filename")+"</td>"+'<td class="plupload_cell plupload_file_status">'+g("Status")+"</td>"+'<td class="plupload_cell plupload_file_size">'+g("Size")+"</td>"+'<td class="plupload_cell plupload_file_action"> </td>'+"</tr>"+"</table>"+'<div class="plupload_scroll">'+'<table class="plupload_filelist_content"></table>'+"</div>"+'<table class="plupload_filelist">'+'<tr class="ui-widget-header ui-widget-content plupload_filelist_footer">'+'<td class="plupload_cell plupload_file_name">'+'<div class="plupload_buttons"><!-- Visible -->'+'<a class="plupload_button plupload_add">'+g("Add Files")+"</a> "+'<a class="plupload_button plupload_start">'+g("Start Upload")+"</a> "+'<a class="plupload_button plupload_stop plupload_hidden">'+g("Stop Upload")+"</a> "+"</div>"+'<div class="plupload_started plupload_hidden"><!-- Hidden -->'+'<div class="plupload_progress plupload_right">'+'<div class="plupload_progress_container"></div>'+"</div>"+'<div class="plupload_cell plupload_upload_status"></div>'+'<div class="plupload_clearer"> </div>'+"</div>"+"</td>"+'<td class="plupload_file_status"><span class="plupload_total_status">0%</span></td>'+'<td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td>'+'<td class="plupload_file_action"></td>'+"</tr>"+"</table>"+"</div>"+"</div>"+"</div>"+'<input class="plupload_count" value="0" type="hidden">'+"</div>")}function g(a){return c.translate(a)||a}var f={};d.widget("ui.plupload",{contents_bak:"",runtime:null,options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",dragdrop:true,multiple_queues:true,buttons:{browse:true,start:true,stop:true},autostart:false,sortable:false,rename:false,max_file_count:0},FILE_COUNT_ERROR:-9001,_create:function(){var a=this,b,e;b=this.element.attr("id");if(!b){b=c.guid();this.element.attr("id",b)}this.id=b;this.contents_bak=this.element.html();h(this.element);this.container=d(".plupload_container",this.element).attr("id",b+"_container");this.filelist=d(".plupload_filelist_content",this.container).attr({id:b+"_filelist",unselectable:"on"});this.browse_button=d(".plupload_add",this.container).attr("id",b+"_browse");this.start_button=d(".plupload_start",this.container).attr("id",b+"_start");this.stop_button=d(".plupload_stop",this.container).attr("id",b+"_stop");if(d.ui.button){this.browse_button.button({icons:{primary:"ui-icon-circle-plus"}});this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:true});this.stop_button.button({icons:{primary:"ui-icon-circle-close"}})}if(!this.options.buttons.browse){this.browse_button.button("disable").hide();d("#"+b+a.runtime+"_container").hide()}if(!this.options.buttons.start){this.start_button.button("disable").hide()}if(!this.options.buttons.stop){this.stop_button.button("disable").hide()}this.progressbar=d(".plupload_progress_container",this.container);if(d.ui.progressbar){this.progressbar.progressbar()}this.counter=d(".plupload_count",this.element).attr({id:b+"_count",name:b+"_count"});e=this.uploader=f[b]=new c.Uploader(d.extend({container:b,browse_button:b+"_browse"},this.options));e.bind("Init",function(b,c){if(!a.options.unique_names&&a.options.rename){a._enableRenaming()}if(e.features.dragdrop&&a.options.dragdrop){a._enableDragAndDrop()}a.container.attr("title",g("Using runtime: ")+(a.runtime=c.runtime));a.start_button.click(function(b){if(!d(this).button("option","disabled")){a.start()}b.preventDefault()});a.stop_button.click(function(a){e.stop();a.preventDefault()})});if(a.options.max_file_count){e.bind("FilesAdded",function(b,c){var d=[],e=c.length;var f=b.files.length+e-a.options.max_file_count;if(f>0){d=c.splice(e-f,f);b.trigger("Error",{code:a.FILE_COUNT_ERROR,message:g("File count error."),file:d})}})}e.init();e.bind("FilesAdded",function(b,c){a._trigger("selected",null,{up:b,files:c});if(a.options.autostart){a.start()}});e.bind("FilesRemoved",function(b,c){a._trigger("removed",null,{up:b,files:c})});e.bind("QueueChanged",function(){a._updateFileList()});e.bind("StateChanged",function(){a._handleState()});e.bind("UploadFile",function(b,c){a._handleFileStatus(c)});e.bind("FileUploaded",function(b,c){a._handleFileStatus(c);a._trigger("uploaded",null,{up:b,file:c})});e.bind("UploadProgress",function(b,c){d("#"+c.id+" .plupload_file_status",a.element).html(c.percent+"%");a._handleFileStatus(c);a._updateTotalProgress();a._trigger("progress",null,{up:b,file:c})});e.bind("UploadComplete",function(b,c){a._trigger("complete",null,{up:b,files:c})});e.bind("Error",function(b,d){var e=d.file,f,h;if(e){f="<strong>"+d.message+"</strong>";h=d.details;if(h){f+=" <br /><i>"+d.details+"</i>"}else{switch(d.code){case c.FILE_EXTENSION_ERROR:h=g("File: %s").replace("%s",e.name);break;case c.FILE_SIZE_ERROR:h=g("File: %f, size: %s, max file size: %m").replace(/%([fsm])/g,function(b,d){switch(d){case"f":return e.name;case"s":return e.size;case"m":return c.parseSize(a.options.max_file_size)}});break;case a.FILE_COUNT_ERROR:h=g("Upload element accepts only %d file(s) at a time. Extra files were stripped.").replace("%d",a.options.max_file_count);break;case c.IMAGE_FORMAT_ERROR:h=c.translate("Image format either wrong or not supported.");break;case c.IMAGE_MEMORY_ERROR:h=c.translate("Runtime ran out of available memory.");break;case c.IMAGE_DIMENSIONS_ERROR:h=c.translate("Resoultion out of boundaries! <b>%s</b> runtime supports images only up to %wx%hpx.").replace(/%([swh])/g,function(a,c){switch(c){case"s":return b.runtime;case"w":return b.features.maxWidth;case"h":return b.features.maxHeight}});break;case c.HTTP_ERROR:h=g("Upload URL might be wrong or doesn't exist");break}f+=" <br /><i>"+h+"</i>"}a.notify("error",f);a._trigger("error",null,{up:b,file:e,error:f})}})},_setOption:function(a,b){var c=this;if(a=="buttons"&&typeof b=="object"){b=d.extend(c.options.buttons,b);if(!b.browse){c.browse_button.button("disable").hide();d("#"+c.id+c.runtime+"_container").hide()}else{c.browse_button.button("enable").show();d("#"+c.id+c.runtime+"_container").show()}if(!b.start){c.start_button.button("disable").hide()}else{c.start_button.button("enable").show()}if(!b.stop){c.stop_button.button("disable").hide()}else{c.start_button.button("enable").show()}}c.uploader.settings[a]=b},start:function(){this.uploader.start();this._trigger("start",null)},stop:function(){this.uploader.stop();this._trigger("stop",null)},getFile:function(a){var b;if(typeof a==="number"){b=this.uploader.files[a]}else{b=this.uploader.getFile(a)}return b},removeFile:function(a){var b=this.getFile(a);if(b){this.uploader.removeFile(b)}},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},_handleState:function(){var a=this,b=this.uploader;if(b.state===c.STARTED){d(a.start_button).button("disable");d([]).add(a.stop_button).add(".plupload_started").removeClass("plupload_hidden");d(".plupload_upload_status",a.element).text(g("Uploaded %d/%d files").replace("%d/%d",b.total.uploaded+"/"+b.files.length));d(".plupload_header_content",a.element).addClass("plupload_header_content_bw")}else{d([]).add(a.stop_button).add(".plupload_started").addClass("plupload_hidden");if(a.options.multiple_queues){d(a.start_button).button("enable");d(".plupload_header_content",a.element).removeClass("plupload_header_content_bw")}a._updateFileList()}},_handleFileStatus:function(a){var b,e;switch(a.status){case c.DONE:b="plupload_done";e="ui-icon ui-icon-circle-check";break;case c.FAILED:b="ui-state-error plupload_failed";e="ui-icon ui-icon-alert";break;case c.QUEUED:b="plupload_delete";e="ui-icon ui-icon-circle-minus";break;case c.UPLOADING:b="ui-state-highlight plupload_uploading";e="ui-icon ui-icon-circle-arrow-w";var f=d(".plupload_scroll",this.container),g=f.scrollTop(),h=f.height(),i=d("#"+a.id).position().top+d("#"+a.id).height();if(h<i){f.scrollTop(g+i-h)}break}b+=" ui-state-default plupload_file";d("#"+a.id).attr("class",b).find(".ui-icon").attr("class",e)},_updateTotalProgress:function(){var a=this.uploader;this.progressbar.progressbar("value",a.total.percent);d(".plupload_total_status",this.element).html(a.total.percent+"%");d(".plupload_upload_status",this.element).text(g("Uploaded %d/%d files").replace("%d/%d",a.total.uploaded+"/"+a.files.length))},_updateFileList:function(){var a=this,b=this.uploader,e=this.filelist,f=0,h,i=this.id+"_",j;if(d.ui.sortable&&this.options.sortable){d("tbody",e).sortable("destroy")}e.empty();d.each(b.files,function(g,k){j="";h=i+f;if(k.status===c.DONE){if(k.target_name){j+='<input type="hidden" name="'+h+'_tmpname" value="'+c.xmlEncode(k.target_name)+'" />'}j+='<input type="hidden" name="'+h+'_name" value="'+c.xmlEncode(k.name)+'" />';j+='<input type="hidden" name="'+h+'_status" value="'+(k.status===c.DONE?"done":"failed")+'" />';f++;a.counter.val(f)}e.append('<tr class="ui-state-default plupload_file" id="'+k.id+'">'+'<td class="plupload_cell plupload_file_name"><span>'+k.name+"</span></td>"+'<td class="plupload_cell plupload_file_status">'+k.percent+"%</td>"+'<td class="plupload_cell plupload_file_size">'+c.formatSize(k.size)+"</td>"+'<td class="plupload_cell plupload_file_action"><div class="ui-icon"></div>'+j+"</td>"+"</tr>");a._handleFileStatus(k);d("#"+k.id+".plupload_delete .ui-icon, #"+k.id+".plupload_done .ui-icon").click(function(a){d("#"+k.id).remove();b.removeFile(k);a.preventDefault()});a._trigger("updatelist",null,e)});d(".plupload_total_file_size",a.element).html(c.formatSize(b.total.size));if(b.total.queued===0){d(".ui-button-text",a.browse_button).text(g("Add Files"))}else{d(".ui-button-text",a.browse_button).text(g("%d files queued").replace("%d",b.total.queued))}if(b.files.length===b.total.uploaded+b.total.failed){a.start_button.button("disable")}else{a.start_button.button("enable")}e[0].scrollTop=e[0].scrollHeight;a._updateTotalProgress();if(!b.files.length&&b.features.dragdrop&&b.settings.dragdrop){d("#"+h+"_filelist").append('<tr><td class="plupload_droptext">'+g("Drag files here.")+"</td></tr>")}else{if(a.options.sortable&&d.ui.sortable){a._enableSortingList()}}},_enableRenaming:function(){var a=this;d(".plupload_file_name span",this.filelist).live("click",function(b){var c=d(b.target),e,f,g,h="";e=a.uploader.getFile(c.parents("tr")[0].id);g=e.name;f=/^(.+)(\.[^.]+)$/.exec(g);if(f){g=f[1];h=f[2]}c.hide().after('<input class="plupload_file_rename" type="text" />');c.next().val(g).focus().blur(function(){c.show().next().remove()}).keydown(function(a){var b=d(this);if(d.inArray(a.keyCode,[13,27])!==-1){a.preventDefault();if(a.keyCode===13){e.name=b.val()+h;c.text(e.name)}b.blur()}})})},_enableDragAndDrop:function(){this.filelist.append('<tr><td class="plupload_droptext">'+g("Drag files here.")+"</td></tr>");this.filelist.parent().attr("id",this.id+"_dropbox");this.uploader.settings.drop_element=this.options.drop_element=this.id+"_dropbox"},_enableSortingList:function(){var a,b=this;if(d("tbody tr",this.filelist).length<2){return}d("tbody",this.filelist).sortable({containment:"parent",items:".plupload_delete",helper:function(a,b){return b.clone(true).find("td:not(.plupload_file_name)").remove().end().css("width","100%")},stop:function(a,c){var e,f,g,h=[];d.each(d(this).sortable("toArray"),function(a,c){h[h.length]=b.uploader.getFile(c)});h.unshift(h.length);h.unshift(0);Array.prototype.splice.apply(b.uploader.files,h)}})},notify:function(a,b){var c=d('<div class="plupload_message">'+'<span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+g("Close")+'"></span>'+'<p><span class="ui-icon"></span>'+b+"</p>"+"</div>");c.addClass("ui-state-"+(a==="error"?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+(a==="error"?"alert":"info")).end().find(".plupload_message_close").click(function(){c.remove()}).end();d(".plupload_header_content",this.container).append(c)},destroy:function(){d(".plupload_button",this.element).unbind();if(d.ui.button){d(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy")}if(d.ui.progressbar){this.progressbar.progressbar("destroy")}if(d.ui.sortable&&this.options.sortable){d("tbody",this.filelist).sortable("destroy")}this.uploader.destroy();this.element.empty().html(this.contents_bak);this.contents_bak="";d.Widget.prototype.destroy.apply(this)}})})(window,document,plupload,jQuery)